machine:
  node:
    version: 0.12.4
  services:
    - mongodb
    - redis
test:
  pre:
    - cp config_sample.json config.json
  override:
    - npm test
    - if [ "$COVERALLS_REPO_TOKEN" != "" ]; then npm run coverage-1; fi
    - if [ "$COVERALLS_REPO_TOKEN" != "" ]; then npm run coverage-2; fi
    - if [ "$COVERALLS_REPO_TOKEN" != "" ]; then npm run coverage-3; fi
    - if [ "$COVERALLS_REPO_TOKEN" != "" ]; then npm run coverage-4; fi
    - if [ "$COVERALLS_REPO_TOKEN" != "" ]; then npm run coverage-5; fi
deployment:
  npm:
    branch: master
    commands:
      - npm version 1.0.$CIRCLE_BUILD_NUM --no-git-tag-version
      - printf "//registry.npmjs.org/:_authToken=$NPM_ACCESS_TOKEN" > npmrc
      - npm publish --userconfig npmrc
      - rm npmrc
